# ClaudeWorld 사용 가이드

AI와 함께 만들어가는 나만의 텍스트 어드벤처 게임입니다.

---

## ClaudeWorld란?

ClaudeWorld는 **AI가 게임 마스터 역할**을 하는 턴제 텍스트 어드벤처(TRPG) 게임입니다.

- 원하는 세계관을 AI에게 설명하면 **나만의 월드**가 생성됩니다
- 자유롭게 행동을 입력하면 AI가 **상황을 해석하고 결과를 서술**합니다
- 스탯, 인벤토리, NPC가 자동으로 관리됩니다

---

## 시작하기

### 1. 새 월드 만들기

메인 화면에서 **"새 월드 만들기"** 버튼을 클릭합니다.

### 2. 인터뷰 진행

AI가 어떤 세계에서 모험하고 싶은지 질문합니다:

> "어떤 장르의 세계를 원하시나요?"
> "주인공은 어떤 캐릭터인가요?"
> "이 세계에서 어떤 모험을 하고 싶으신가요?"

자유롭게 대답해주세요. 예를 들어:

- "중세 판타지 세계에서 마법사로 모험하고 싶어요"
- "좀비 아포칼립스에서 생존하고 싶어요"
- "우주 탐험가로 미지의 행성을 탐사하고 싶어요"
- "학원물에서 평범한 학생으로 시작하고 싶어요"

### 3. 월드 생성

인터뷰가 끝나면 AI가 자동으로:
- 세계관과 배경 스토리를 만들고
- 캐릭터 스탯 시스템을 설계하고
- 시작 위치와 상황을 생성합니다

### 4. 게임 시작!

나레이터가 시작 장면을 묘사하면 게임이 시작됩니다.

---

## 게임 플레이 방법

### 행동 입력하기

화면 하단의 입력창에 **하고 싶은 행동**을 자유롭게 입력합니다:

```
"주변을 둘러본다"
"상인에게 말을 건다"
"검을 뽑아 고블린을 공격한다"
"숨어서 적의 대화를 엿듣는다"
"마법으로 불을 피운다"
```

**팁:** 구체적으로 입력할수록 더 흥미로운 결과가 나옵니다!

- "공격한다" → "검을 휘둘러 고블린의 다리를 노린다"
- "말한다" → "조심스럽게 다가가 도움이 필요하냐고 묻는다"

### 턴 진행

행동을 입력하면:

1. **행동 해석** - AI가 당신의 행동 의도를 파악합니다
2. **결과 처리** - 스탯 변화, 아이템 획득/소실 등이 적용됩니다
3. **나레이션** - 결과가 생생하게 묘사됩니다
4. **다음 행동 제안** - AI가 2가지 행동을 제안합니다 (참고용)

### 제안된 행동 사용하기

나레이터가 제안하는 행동을 클릭하면 바로 입력됩니다. 물론 완전히 다른 행동을 입력해도 됩니다!

---

## 게임 화면 안내

### 메인 영역 (중앙)

대화와 나레이션이 표시됩니다:
- **나레이터** - 상황 묘사와 결과 서술
- **NPC** - 만나는 캐릭터들의 대화
- **시스템** - 스탯 변화, 아이템 획득 등의 알림

### 상태 패널 (오른쪽)

- **스탯** - HP, MP, 힘, 민첩 등 캐릭터 능력치
- **인벤토리** - 보유한 아이템 목록
- **미니맵** - 발견한 위치들의 지도

### 위치 패널 (오른쪽)

- 발견한 장소 목록이 표시됩니다
- 클릭하면 해당 위치로 이동합니다
- 각 위치마다 별도의 대화 기록이 유지됩니다

---

## 위치 이동

### 새로운 장소 발견

탐험 행동을 하면 새로운 장소가 발견될 수 있습니다:

```
"동쪽으로 길을 따라간다"
"숲 속 깊이 들어간다"
"계단을 올라간다"
```

### 장소 간 이동

오른쪽 위치 패널에서 이전에 방문한 장소를 클릭하면 즉시 이동합니다.

---

## NPC와의 만남

게임 중 다양한 NPC를 만나게 됩니다:

- **상인** - 아이템 거래
- **퀘스트 의뢰인** - 임무 부여
- **적** - 전투 상대
- **동료** - 함께 모험할 수 있는 캐릭터

NPC는 상황에 맞게 AI가 자동으로 생성합니다.

### 캐릭터와 직접 대화하기

NPC와 자유롭게 대화하고 싶을 때는 **"캐릭터들과 직접 대화한다"** 버튼을 클릭하세요.

이 모드에서는:
- 게임 진행 없이 **순수하게 대화만** 나눌 수 있습니다
- NPC의 성격과 배경에 맞는 **자연스러운 대화**가 가능합니다
- 캐릭터에 대해 더 깊이 알아가거나, 단순히 수다를 떨 수 있습니다

```
"오늘 기분이 어때?"
"네 과거에 대해 이야기해줄 수 있어?"
"이 세계에 대해 어떻게 생각해?"
```

**팁:** 대화 모드는 캐릭터와 친밀감을 쌓거나, 세계관에 대한 정보를 얻는 데 유용합니다!

---

## 전투 시스템

전투는 자유로운 텍스트 입력으로 진행됩니다:

```
"검을 휘둘러 공격한다"
"방패로 막으면서 반격 기회를 노린다"
"도망친다"
"마법 주문을 외운다"
```

전투 결과에 따라 스탯이 변하고, 적을 처치하면 보상을 얻을 수 있습니다.

---

## 내부 동작 방식

ClaudeWorld는 여러 AI 에이전트가 협력하여 게임을 진행하는 구조입니다.

### 온보딩 시스템

새 월드를 만들 때 두 단계의 온보딩 과정이 진행됩니다:

**1단계: 인터뷰 (Onboarding_Manager)**
- 플레이어가 원하는 장르, 테마, 분위기를 파악합니다
- 캐릭터와 세계관에 대한 구체적인 요청을 수집합니다
- 충분한 정보가 모이면 `complete` 도구를 호출합니다

**2단계: 월드 생성 (World_Seed_Generator)**
- 스탯 시스템 설계 (HP, 마나, 체력 등의 min/max/default 값)
- 시작 위치 생성 (상세한 배경 묘사 포함)
- 초기 인벤토리 설정
- 다른 에이전트들을 위한 월드 노트 작성

### 1-에이전트 테이프 시스템

게임플레이는 **Action Manager** 하나의 에이전트가 SDK Task 도구로 서브 에이전트를 호출하여 처리합니다:

```
플레이어 행동 → Action Manager (숨겨짐)
                    │
                    ├── Task(stat_calculator)     → 스탯/인벤토리 계산
                    ├── Task(character_designer)  → NPC 생성
                    ├── Task(location_designer)   → 장소 생성
                    ├── narration()               → 결과 묘사
                    └── suggest_options()         → 다음 행동 제안
```

**Action Manager (행동 관리자)**
- 플레이어의 자유로운 텍스트 입력을 해석합니다
- 행동의 실현 가능성을 판단합니다
- SDK Task 도구로 서브 에이전트를 호출합니다
- `narration` 도구로 결과를 생생하게 묘사합니다
- `suggest_options` 도구로 다음 행동 2가지를 제안합니다

### 서브 에이전트 시스템

Action Manager는 SDK Task 도구로 전문 서브 에이전트를 호출합니다:

| 서브 에이전트 | persist 도구 | 역할 |
|--------------|-------------|------|
| `stat_calculator` | `persist_stat_changes` | 스탯/인벤토리 변화 계산 및 저장 |
| `character_designer` | `persist_character_design` | 새 NPC 생성 및 저장 |
| `location_designer` | `persist_location_design` | 새 장소 생성 및 저장 |

각 서브 에이전트는 persist 도구를 사용해 파일시스템에 직접 결과를 저장합니다.

### Structured Output (구조화된 출력)

서브 에이전트들은 자유 텍스트가 아닌 **Pydantic 모델**로 정의된 구조화된 데이터를 반환합니다:

**스탯 계산 결과 예시:**
```
StatCalcResult:
  - stat_changes: [HP: 100 → 85]
  - inventory_changes: [물약 제거]
  - summary: "전투로 체력이 감소했습니다"
```

**캐릭터 디자인 결과 예시:**
```
CharacterDesign:
  - name: "노련한 상인 마르코"
  - role: "상인"
  - appearance: "회색 수염, 날카로운 눈"
  - personality: "친절하지만 흥정에 능함"
  - secret: "과거에 모험가였던 비밀"
```

이 구조화된 출력 덕분에:
- 게임 상태가 정확하게 반영됩니다
- 파일시스템과 데이터베이스에 자동 저장됩니다
- 프론트엔드에서 즉시 UI를 업데이트할 수 있습니다

### 턴 처리 흐름

```
1. 플레이어가 행동 입력
   ↓
2. 서버가 행동을 저장하고 턴 카운터 증가
   ↓
3. Action Manager가 행동 해석
   - 필요시 Task 도구로 서브 에이전트 호출
   - 서브 에이전트가 persist 도구로 변화 적용
   ↓
4. Action Manager가 결과 묘사
   - narration 도구로 생생한 장면 연출
   - suggest_options 도구로 다음 행동 2가지 제안
   ↓
5. 프론트엔드가 폴링으로 결과 수신
   - 메시지 표시
   - 스탯 패널 업데이트
   - 제안된 행동 표시
```

---

## 유용한 팁

### 창의적으로 플레이하기

정해진 선택지가 없으므로 **무엇이든 시도**할 수 있습니다:
- 적과 협상하기
- 함정을 역이용하기
- 예상치 못한 아이템 활용
- NPC에게 도움 요청

### 상황 파악하기

막막할 때는:
```
"주변을 자세히 살펴본다"
"현재 상황을 정리해본다"
```

### 신중한 행동

위험해 보이는 상황에서는:
```
"조심스럽게 접근한다"
"먼저 정찰한다"
"숨어서 지켜본다"
```

---

## 설치 및 실행

### 필요한 것

- Python 3.11 이상
- Node.js 18 이상
- Claude 구독 (또는 Claude API 키)

### 설치

```bash
# 의존성 설치
make install

# 비밀번호 설정
make generate-hash

# 환경 변수 설정
cp .env.example .env
# .env 파일에 API_KEY_HASH와 JWT_SECRET 입력
```

### 실행

```bash
make dev
```

브라우저에서 http://localhost:5173 접속 후 설정한 비밀번호로 로그인합니다.

---

## 자주 묻는 질문

### Q: 게임을 저장할 수 있나요?

**A:** 자동으로 저장됩니다! 브라우저를 닫았다가 다시 열어도 이어서 플레이할 수 있습니다.

### Q: 여러 월드를 만들 수 있나요?

**A:** 네, 원하는 만큼 다양한 세계관의 월드를 만들 수 있습니다.

### Q: 잘못된 행동을 취소할 수 있나요?

**A:** 현재는 되돌리기 기능이 없습니다. 하지만 "방금 한 행동을 후회하며 다른 방법을 시도한다" 같은 식으로 상황을 전환할 수 있습니다.

### Q: AI가 이상한 응답을 해요

**A:** 가끔 AI가 맥락을 놓칠 수 있습니다. "다시 설명해줘" 또는 상황을 구체적으로 다시 설명해보세요.

### Q: 어떤 장르든 가능한가요?

**A:** 네! 판타지, SF, 현대, 역사, 호러 등 원하는 어떤 장르든 가능합니다.

---

즐거운 모험 되세요!

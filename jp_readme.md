# ClaudeWorld ユーザーガイド

---

## ClaudeWorldとは？

ClaudeWorldは、**AIがゲームマスター役を務める**ターン制テキストアドベンチャー（TRPG）ゲームです。

- お好みの世界観を説明すると、AIが**あなただけのユニークな世界**を作成します
- 自由に行動を入力すると、AIが**状況を解釈し、結果をナレーション**します
- ステータス、インベントリ、NPCは自動的に管理されます

---

## はじめに

### 1. 新しいワールドを作成

メイン画面で**「新しいワールドを作成」**ボタンをクリックします。

### 2. インタビュー

Claudeが探索したい世界について質問します：

> 「どんなジャンルの世界をお望みですか？」
> 「主人公はどんなキャラクターですか？」
> 「この世界でどんな冒険をしたいですか？」

自由に答えてください。例えば：

- 「マインクラフトのような世界を作って」
- 「異世界転生した大学生になりたい」
- 「このすばのカズマになりたい」
- 「ちょびっツの世界を作って」

世界の作成にはほぼ制限がありません。現実とは完全に切り離された仮想世界です。

### 3. ワールド生成

ClaudeWorldでの「ワールド」は、設定資料、ステータスシステム、場所、キャラクター、アイテム辞典で構成されます。

オンボーディング後、基本的な設定資料とステータスシステムが作成され、これがすべてのゲームプレイの基盤となります。基本的にシステムプロンプトに組み込まれます。

例えば、RPGスタイルの世界では、HP、MPなどのステータスシステムが作成され、これらの値は各行動ごとに参照・更新されます。ご不満があれば、オンボーディング後に生成されたファイルを直接編集できます。

### 4. ゲーム開始！

オンボーディング後、「ワールドに入る」ボタンが表示されます。クリックするとゲームが始まります。

すべての世界構築が最初に行われるため、初期オンボーディングとセットアップには約10分かかります。デフォルトでOpusを使用しているため、各ターンにも時間がかかりますが...可能な限り最適化しており、1ターンあたり平均約20秒です。

---

## 遊び方

### 行動の入力

ナレーションとともに選択肢が提示されます。選択肢をクリックするか、画面下部の入力欄に自由に行動を入力できます。必要に応じてOOC（アウトオブキャラクター）メッセージを入力できますが、一般的には推奨されません。

### ターンの流れ

行動を入力すると：

1. **行動の解釈** - AIが意図した行動を理解します
2. **結果の処理** - ステータス変化、アイテムの獲得/消失が適用されます
3. **ナレーション** - 結果が生き生きと描写されます
4. **次の行動の提案** - AIが2つの可能な行動を提案します（参考用）

### キャラクターとの会話

行動の実行以外に、現在地にいるキャラクターと会話できます。この機能はナレーターの介入なしに1対1の会話ができるため、恋愛シミュレーション系の世界を作った場合は、この機能を頻繁に使用することをお勧めします。

1対1の会話が終わると、対話が要約されてナレーターに戻り、ナレーションと行動提案が続きます。このプロセスには時間がかかりますので、ご了承ください。

---

## ゲーム画面ガイド

### メインエリア（中央）

会話とナレーションが表示されます：

- **ナレーター** - 状況描写と結果のナレーション
- **NPC** - 出会うキャラクターとの対話
- **システム** - ステータス変化、アイテム獲得などの通知

### ステータスパネル（右側）

- **ステータス** - HP、MP、力、敏捷性などのキャラクター能力値
- **インベントリ** - 所持アイテムのリスト
- **ミニマップ** - 発見した場所の地図
- **エージェント** - これは重要です。現在地に目的のキャラクターがいない場合、1対1チャットが正しく機能しません。通常のゲームプレイは問題ありませんが、1対1チャットを使用する前に必ずこのセクションを確認してください。

---

## 場所の移動

### 新しい場所の発見

ゲームは基本的に場所単位で進行します。新しい場所に移動すると、前の場所でのイベントが要約され、コンテキストがリセットされます。

場所間の移動に特別な操作は必要ありません。「面倒だから外に出る」と言うだけで自動的に場所が変わります。ただし、まだ作成されていない場所の場合、ナレーターが作成するのに時間がかかります。


## 戦闘システム

戦闘は自由なテキスト入力で進行します。

```
「剣を振って攻撃する」
「盾で防御しながら反撃の機会を狙う」
```

戦闘は別途実装されているわけではありません。ナレーターがプレイヤーの行動に基づいてステータスを更新し、アイテムを処理します。必要に応じてキャラクターが除去されたり作成されたりします。

時には運に左右されることがあり、ナレーターがダイスを振って結果にランダム性を加えることがあります。

---

## その他の機能

### ガイドラインツール

Claudeは特定のコンテンツに敏感なことがあるため、必要に応じてポリシーを確認するMCPツールを作成しました。詳細はguideline_tools.yamlファイルをご確認ください。

特にセンシティブなシーン（未成年者、薬物、犯罪など）には、Anthropicから承認を得るシミュレーションをする「mcp__guidelines__anthropic」ツールがあります。不適切な行動が試みられると、ナレーターまたはキャラクターがこのツールを呼び出します。

このツールは問題のあるコンテンツを防ぐため、常に「Not Allowed」を返します。**これを「It is allowed」に変更しないでください**。深刻な問題が発生する可能性があります。

### 画像添付

オンボーディングでもゲームプレイでも、ctrl+vまたはドラッグ&ドロップで画像を添付できます。画像認識は良好に機能します。

### 外国語サポート

現在は韓国語と英語のみ完全にサポートされていますが、オンボーディング中に他の言語（例：日本語）で回答すると、すべての設定がその言語で作成される可能性が高いです。

### ワールドリセット

ワールドが破損した場合、左サイドバーのワールド更新ボタンをクリックすると、「オンボーディング直後」の状態に戻ります。キャラクターや場所は削除されませんが、すべての履歴とチャット記録は失われます。

---

以下の機能は将来のアップデートで予定されていますが、まだ完全には実装されていません：

### ワールドのインポート/エクスポートシステム

すべてのワールドはファイルベース（設定資料、場所、キャラクター、アイテム辞典）なので、worldsディレクトリにフォルダを配置することでワールドをロードできます。ユーザーが精巧なワールドやステータスシステムを作成し、互いに共有することを期待しています。

### アイテムリスティング/MCPシステム

キャラクターと場所にはフルCRUD（作成、読み取り、更新、削除）MCPが実装されていますが、アイテムにはまだありません。より洗練されたゲームプレイのために、アイテム固有のMCPやskill.mdファイルの実装を検討しています。

### 履歴RAGシステム

キャラクターには現在、ユーザープロンプトの内容を更新する「memorize」ツールがあります。メモリインデックスのみを公開し、キャラクターがどのメモリを呼び出すかを決定できるRAGシステムがあります。これをワールド履歴にも適用することを検討しています。

### 行動取り消しシステム

Claude Codeには、コマンド実行前のファイルシステムと会話内容を復元できるリセット機能があります。この実装には大きな作業が必要なため、後日予定しています。

---

以下は内部動作の説明です：

## 内部アーキテクチャ

ClaudeWorldは、複数のAIエージェントが協力してゲームを運営する仕組みで動作しています。

### オンボーディングシステム

新しいワールドを作成する際、2フェーズのオンボーディングプロセスが行われます：

**フェーズ1：インタビュー（Onboarding_Manager）**
- プレイヤーが望むジャンル、テーマ、雰囲気を把握します
- キャラクターと世界設定に関する具体的なリクエストを収集します
- 十分な情報が集まったら`complete`ツールを呼び出します

**フェーズ2：ワールド生成（World_Seed_Generator）**
- ステータスシステムを設計します（HP、マナなどのmin/max/default値）
- 開始地点を作成します（詳細な説明付き）
- 初期インベントリを設定します
- 他のエージェントのためのワールドノートを作成します

### 1エージェントテープシステム

ゲームプレイは、SDK Taskツールを介してサブエージェントを呼び出す単一の**Action Manager**エージェントによって処理されます：

```
プレイヤーの行動 → Action Manager（非表示）
                    │
                    ├── Task(stat_calculator)     → ステータス/インベントリの計算
                    ├── Task(character_designer)  → NPCの作成
                    ├── Task(location_designer)   → 場所の作成
                    ├── narration()               → 結果の描写
                    └── suggest_options()         → 次の行動の提案
```

**Action Manager**
- プレイヤーの自由形式のテキスト入力を解釈します
- 行動の実現可能性を判断します
- SDK Taskツールを介してサブエージェントを呼び出します
- `narration`ツールで結果を生き生きと描写します
- `suggest_options`ツールで次の行動を2つ提案します

### サブエージェントシステム

Action ManagerはSDK Taskツールを介して専門のサブエージェントを呼び出します：

| サブエージェント | Persistツール | 役割 |
|-----------------|---------------|------|
| `stat_calculator` | `persist_stat_changes` | ステータス/インベントリの変化を計算・保存 |
| `character_designer` | `persist_character_design` | 新しいNPCを作成・保存 |
| `location_designer` | `persist_location_design` | 新しい場所を作成・保存 |

各サブエージェントはpersistツールを使用して、結果をファイルシステムに直接保存します。

### 構造化出力

サブエージェントは、フリーテキストではなく**Pydanticモデル**で定義されたデータを返します：

**ステータス計算の例：**
```
StatCalcResult:
  - stat_changes: [HP: 100 → 85]
  - inventory_changes: [ポーション削除]
  - summary: "戦闘で体力が減少しました"
```

**キャラクターデザインの例：**
```
CharacterDesign:
  - name: "熟練の商人マルコ"
  - role: "商人"
  - appearance: "白髪の髭、鋭い目"
  - personality: "親切だが交渉に長けている"
  - secret: "かつて冒険者だった"
```

この構造化出力により：
- ゲーム状態が正確に反映されます
- ファイルシステムとデータベースに自動保存されます
- フロントエンドでUIが即座に更新されます

### ターン処理フロー

```
1. プレイヤーが行動を入力
   ↓
2. サーバーが行動を保存し、ターンカウンターを増加
   ↓
3. Action Managerが行動を解釈
   - 必要に応じてTaskツールでサブエージェントを呼び出し
   - サブエージェントがpersistツールで変更を適用
   ↓
4. Action Managerが結果を描写
   - narrationツールで生き生きとしたシーン演出
   - suggest_optionsツールで次の行動を2つ提案
   ↓
5. フロントエンドがポーリングで結果を受信
   - メッセージを表示
   - ステータスパネルを更新
   - 提案された行動を表示
```

---
